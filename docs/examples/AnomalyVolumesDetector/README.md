# Anomaly Volumes Detector

[–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º](#–î–µ—Ç–µ–∫—Ç–æ—Ä-–∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö-–æ–±—ä—ë–º–æ–≤)

<a href="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/README_EN.md" target="_blank"><img src="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/docs/media/TKSBrokerAPI-Logo.png?raw=true" alt="TKSBrokerAPI-Logo" width="780" /></a>

**T**echnologies ¬∑ **K**nowledge ¬∑ **S**cience

[![task](https://badgen.net/badge/issue/119/red)](https://github.com/Tim55667757/TKSBrokerAPI/issues/119)
[![gift](https://badgen.net/badge/gift/donate/green)](https://yoomoney.ru/fundraise/4WOyAgNgb7M.230111)


## Acknowledgements

* Idea and sponsorship: [Jolids](https://github.com/Jolids)
* Developer: [Timur Gilmullin](https://github.com/Tim55667757)

## Description

**[Anomaly Volumes Detector](https://github.com/Tim55667757/TKSBrokerAPI/tree/develop/docs/examples/AnomalyVolumesDetector)** is a simple Telegram bot, based on the TKSBrokerAPI platform, for detecting anomaly volumes in Buyers and Sellers orders.

The bot monitors the volumes of Buyers and Sellers in the orders book (DOM), looks for anomalies in the number series of volumes and notifies in Telegram. The notification contains: the current price and prices with anomaly volumes.

### Concept

Main steps: 

- The script enters the market on schedule, e.g. crontab format: `timeToWork: "*/2 10-21 * * 1-5"` (at every 2nd minute past every hour from 10 through 22 (including) on every day-of-week from Monday through Friday). See also [another examples](https://crontab.guru/#*/2_10-21_*_*_1-5).

- In a parallel (multiprocessing) conveyor mode, it requests data on the state of the order book for the specified instruments and with the specified depth of the order book (`depth <= 50`).

- For each order book, it searches for all current anomalies in the volumes of Sellers and Buyers (filtering by [Hampel method](https://nbviewer.org/github/Tim55667757/TKSBrokerAPI/blob/develop/docs/examples/HampelFilteringExample_EN.ipynb) along the entire length of the current DOM).

- If the list of anomalies is not empty, then script generates a human-readable message, for example:
    ```
    Anomalous volumes detected
    of Sellers and Buyers:
      - [YNDX] [Shares] [Yandex]
      - Date and time:
        2023-01-29 14:51:54 UTC
      - Is in portfolio: No

    - Current price/volume/value
      - Buy (1st seller price):
        [0] 1928.1/5/9640.5 rub
      - Sell (1st buyer price):
        [0] 1916.4/3/5749.2 rub

    - Anomaly, price/volume/value
      - in sellers volumes: 
        [5] 1929.1/6/11574.6 rub
        [14] 1930.9/6/11585.4 rub
      - in buyers volumes: 
        [0] 1916.4/3/5749.2 rub
        [1] 1916.2/6/11497.2 rub

    Generated by ‚öôÔ∏è TKSBrokerAPI
    ```

- Connect to the specified TG-bot by token and send a notification through it.

  <a href="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/README_EN.md#Module-import" target="_blank"><img src="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/docs/media/AnomalyVolumesDetector-TG-example-EN.jpg?raw=true" alt="AnomalyVolumesDetector-example" width="307" /></a>

### Bot launch

All parameters are configured in two configuration files: [`config.yaml`](./config.yaml) and [`secrets.yaml`](./secrets.yaml), which must be present next to the script [`TKSAVDetector.py`](./TKSAVDetector.py). 

The script works with `python >= 3.9`, and dependencies from [`requirements.txt`](./requirements.txt) must also be installed. Steps to start on a new server:

```commandline
git clone https://github.com/Tim55667757/TKSBrokerAPI.git
cd ./TKSBrokerAPI/docs/examples/AnomalyVolumesDetector
python3 -m pip install -r requirements.txt
python3 TKSAVDetector.py config.yaml secrets.yaml
```

If you're using default names `config.yaml` and `secrets.yaml`, then they can be omitted in `python3 TKSAVDetector.py` command.

### Auth

All critical secrets must store locally in [`secrets.yaml`](./secrets.yaml) file. You can define there some parameters:

* `userToken` ‚Äî place here the Tinkoff Investment API token (`t.*****`) or stay it empty and use `TKS_API_TOKEN` environment variable;
* `userAccount` ‚Äî place here the `accountId` of Tinkoff Investment broker account or stay it empty and use `TKS_ACCOUNT_ID` environment variable;
* `botToken` ‚Äî place here TG bot token (`******:***`) or stay it empty and use `TKS_BOT_TOKEN` environment variable;
* `chatId` ‚Äî Telegram Chat ID with authorized user for sending messages.

How to create the Tinkoff Investment API token [see here](https://tinkoff.github.io/investAPI/token/). After creating token, store it to `userToken` variable in `secrets.yaml` or in `TKS_API_TOKEN` environment variable.

You can find `accountId` number using the TKSBrokerAPI platform with command: `tksbrokerapi --accounts` and then store it to `userAccount` variable in `secrets.yaml` or in `TKS_ACCOUNT_ID` environment variable.

How to create new Telegram bot and receive token [see here](https://core.telegram.org/bots/features#botfather). After creating bot, store its token to `botToken` variable in `secrets.yaml` or in `TKS_BOT_TOKEN` environment variable. See also, Telegram [auth and some examples](https://core.telegram.org/bots/api#authorizing-your-bot).

How you can find Chat ID for `chatId` variable:
  - when the bot will be created, you store its token;
  - join and authorize bot in Telegram (`/start` command);
  - send any message to bot;
  - go to url: https://api.telegram.org/bot<place_your_token_here>/getUpdates
  - find your message in response text and take `id` as `chatId` variable your need.

### Methods

* The `ConfigDecorator()` method is a wrapper (decorator) for loading configuration files and secrets, controlling the start time of iterations on a schedule, for a single run or in infinite mode, as well as for parameterizing the Trade Manager.
    - Decorator `ConfigDecorator()`:
      - loads settings from configuration files,
      - checks the number of CPU available for parallelization,
      - checks if it's working time (according to crontab settings),
      - launches the Trade Manager once or in infinite mode.

* The `TradeManager()` method is a manager for initializing, launching and managing parallel pipelines, which will analyze the state of the order book for a specific set of tickers.
    - Manager `TradeManager()`:
      - initializes the reporter (an instance of the `TinkoffBrokerServer()` class for generating reports),
      - updates the cache for instruments once and gets the user's portfolio so that they are not updated on each pipeline once again,
      - starts iteration over all tickers, splits them into sets,
      - each set sends to its own pipeline for parallelization.

* The `TradeScenario()` class contains methods for implementing the trading scenario logic. It has two important methods: `Run()` and `Steps()`.
    - `Run()` is a runner of trade steps for all given instruments tickers.
    - `Steps()` is a section for implementing the steps of the trading scenario for one current instrument.


üöÄ Good luck for you in trade automation! And profit!

[![gift](https://badgen.net/badge/gift/donate/green)](https://yoomoney.ru/fundraise/4WOyAgNgb7M.230111)


---


# –î–µ—Ç–µ–∫—Ç–æ—Ä –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –æ–±—ä—ë–º–æ–≤

[See doc in English](#Anomaly-Volumes-Detector)

<a href="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/README_EN.md" target="_blank"><img src="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/docs/media/TKSBrokerAPI-Logo.png?raw=true" alt="TKSBrokerAPI-Logo" width="780" /></a>

**T**echnologies ¬∑ **K**nowledge ¬∑ **S**cience

[![task](https://badgen.net/badge/issue/119/red)](https://github.com/Tim55667757/TKSBrokerAPI/issues/119)
[![gift](https://badgen.net/badge/gift/donate/green)](https://yoomoney.ru/fundraise/4WOyAgNgb7M.230111)


## –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

* –ò–¥–µ—è –¢–ì-–±–æ—Ç–∞ –∏ —Å–ø–æ–Ω—Å–æ—Ä—Å—Ç–≤–æ: [Jolids](https://github.com/Jolids)
* –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: [–¢–∏–º—É—Ä –ì–∏–ª—å–º—É–ª–ª–∏–Ω](https://github.com/Tim55667757)

## –û–ø–∏—Å–∞–Ω–∏–µ

**[–î–µ—Ç–µ–∫—Ç–æ—Ä –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –æ–±—ä—ë–º–æ–≤](https://github.com/Tim55667757/TKSBrokerAPI/tree/develop/docs/examples/AnomalyVolumesDetector)** ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π –¢–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ–±—ä—ë–º–æ–≤ —Å–ø—Ä–æ—Å–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤.

–ë–æ—Ç —Å–ª–µ–¥–∏—Ç –∑–∞ –æ–±—ä—ë–º–∞–º–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –≤ –±–∏—Ä–∂–µ–≤–æ–º —Å—Ç–∞–∫–∞–Ω–µ, –∏—â–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –≤ —á–∏—Å–ª–æ–≤–æ–º —Ä—è–¥—É –æ–±—ä—ë–º–æ–≤ –∏ –æ–ø–æ–≤–µ—â–∞–µ—Ç –æ –Ω–∏—Ö –≤ –¢–µ–ª–µ–≥—Ä–∞–º. –û–ø–æ–≤–µ—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç: —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ —Ü–µ–Ω—ã —Å –∞–Ω–æ–º–∞–ª—å–Ω—ã–º–∏ –æ–±—ä—ë–º–∞–º–∏.

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏: 

- –°–∫—Ä–∏–ø—Ç –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ —Ä—ã–Ω–æ–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ñ–æ—Ä–º–∞—Ç–µ crontab: `timeToWork: "*/2 10-21 * * 1-5"` (c 10:00 —É—Ç—Ä–∞ –¥–æ 22:00 –≤–µ—á–µ—Ä–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ) –≤ –±—É–¥–Ω–∏–µ –¥–Ω–∏, –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã). –ú–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ [–ø—Ä–∏–º–µ—Ä—ã](https://crontab.guru/#*/2_10-21_*_*_1-5).

- –í –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º (–º—É–ª—å—Ç–∏–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–º) –∫–æ–Ω–≤–µ–π–µ—Ä–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –±–∏—Ä–∂–µ–≤–æ–≥–æ —Å—Ç–∞–∫–∞–Ω–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –∏ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –≥–ª—É–±–∏–Ω–æ–π —Å—Ç–∞–∫–∞–Ω–∞ (`depth <= 50`).

- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞–∫–∞–Ω–∞ —Å–∫—Ä–∏–ø—Ç –∏—â–µ—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –æ–±—ä—ë–º–∞—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è [–º–µ—Ç–æ–¥–æ–º –•–∞–º–ø–µ–ª—è](https://nbviewer.org/github/Tim55667757/TKSBrokerAPI/blob/develop/docs/examples/HampelFilteringExample.ipynb) –ø–æ –≤—Å–µ–π –¥–ª–∏–Ω–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞–∫–∞–Ω–∞).

- –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∞–Ω–æ–º–∞–ª–∏–π –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –ø–æ–ª—É—á–∏–ª—Å—è –Ω–µ –ø—É—Å—Ç–æ–π, —Ç–æ —Å–∫—Ä–∏–ø—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞:
    ```
    –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ –æ–±—ä—ë–º—ã
    –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:
      - [YNDX] [Shares] [Yandex]
      - –í—Ä–µ–º—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è:
        2023-01-29 14:49:31 UTC
      - –ï—Å—Ç—å –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ: –ù–µ—Ç

    - –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞/–æ–±—ä—ë–º/—Å—Ç–æ–∏–º–æ—Å—Ç—å
      - –ö—É–ø–∏—Ç—å:
        [0] 1927.6/4/7710.4 —Ä—É–±
      - –ü—Ä–æ–¥–∞—Ç—å:
        [0] 1915.9/4/7663.6 —Ä—É–±

    - –ê–Ω–æ–º–∞–ª–∏–∏
      - –≤ –æ–±—ä—ë–º–∞—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤: 
        [0] 1927.6/4/7710.4 —Ä—É–±
        [3] 1928.2/6/11569.2 —Ä—É–±
      - –≤ –æ–±—ä—ë–º–∞—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π: 
        [0] 1915.9/4/7663.6 —Ä—É–±
        [1] 1915.7/6/11494.2 —Ä—É–±

    –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ‚öôÔ∏è TKSBrokerAPI
    ```

- –°–∫—Ä–∏–ø—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –¢–ì-–±–æ—Ç—É –ø–æ —Ç–æ–∫–µ–Ω—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ –Ω–µ–≥–æ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ.

  <a href="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/README.md#–ö–∞–∫-Python-API-—á–µ—Ä–µ–∑-–∏–º–ø–æ—Ä—Ç-–º–æ–¥—É–ª—è-TKSBrokerAPI" target="_blank"><img src="https://github.com/Tim55667757/TKSBrokerAPI/blob/develop/docs/media/AnomalyVolumesDetector-TG-example-RU.jpg?raw=true" alt="AnomalyVolumesDetector-example" width="307" /></a>

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –¥–≤—É—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö: [`config.yaml`](./config.yaml) –∏ [`secrets.yaml`](./secrets.yaml), –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä—è–¥–æ–º —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º [`TKSAVDetector.py`](./TKSAVDetector.py). 

–°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `python >= 3.9`, –∞ —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ [`requirements.txt`](./requirements.txt). –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

```commandline
git clone https://github.com/Tim55667757/TKSBrokerAPI.git
cd ./TKSBrokerAPI/docs/examples/AnomalyVolumesDetector
python3 -m pip install -r requirements.txt
python3 TKSAVDetector.py config.yaml secrets.yaml
```

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `config.yaml` –∏ `secrets.yaml`, —Ç–æ –≤ –∫–æ–º–∞–Ω–¥–µ `python3 TKSAVDetector.py` –∏—Ö –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å.

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ —Ñ–∞–π–ª–µ [`secrets.yaml`](./secrets.yaml). –í—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∞–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

* `userToken` ‚Äî —É–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å —Å–≤–æ–π API-—Ç–æ–∫–µ–Ω –æ—Ç –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ (`t.*****`) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `TKS_API_TOKEN`;
* `userAccount` ‚Äî —É–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å —Å–≤–æ–π `accountId`, —ç—Ç–æ —Å—á—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `TKS_ACCOUNT_ID`;
* `botToken` ‚Äî —É–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å —Ç–æ–∫–µ–Ω –æ—Ç –≤–∞—à–µ–≥–æ –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ (`******:***`) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `TKS_BOT_TOKEN`;
* `chatId` ‚Äî —É–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å ID –Ω–æ–º–µ—Ä –¢–µ–ª–µ–≥—Ä–∞–º-—á–∞—Ç–∞, –≥–¥–µ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏ –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å API-—Ç–æ–∫–µ–Ω –≤ –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, —Å–º–æ—Ç—Ä–∏—Ç–µ [–ø–æ —Å—Å—ã–ª–∫–µ](https://tinkoff.github.io/investAPI/token/). –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `userToken` (–≤ `secrets.yaml`) –∏–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `TKS_API_TOKEN`.

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –Ω–æ–º–µ—Ä —Å–≤–æ–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ `accountId` –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã TKSBrokerAPI: `tksbrokerapi --accounts`. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `userAccount` (–≤ `secrets.yaml`) –∏–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `TKS_ACCOUNT_ID`.

–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –Ω–µ–≥–æ, —Å–º–æ—Ç—Ä–∏—Ç–µ [–ø–æ —Å—Å—ã–ª–∫–µ](https://core.telegram.org/bots/features#botfather). –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `botToken` (–≤ `secrets.yaml`) –∏–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `TKS_BOT_TOKEN`. –°–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–∫–∂–µ [–ø—Ä–∏–º–µ—Ä—ã](https://core.telegram.org/bots/api#authorizing-your-bot), –∫–∞–∫ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –¢–µ–ª–µ–≥—Ä–∞–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

–ö–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ ID —á–∞—Ç–∞ —Å –±–æ—Ç–æ–º –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `chatId`:
  - –∫–æ–≥–¥–∞ –±–æ—Ç –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω, –≤—ã —É–∑–Ω–∞–µ—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ —Ç–æ–∫–µ–Ω;
  - –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–æ—Ç—É –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ –µ–≥–æ –≤ Telegram –∫–æ–º–∞–Ω–¥–æ–π `/start`, —á—Ç–æ–±—ã –æ–Ω –º–æ–≥ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–∞–º —Å–æ–æ–±—â–µ–Ω–∏—è;
  - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É;
  - –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π —Ç–æ–∫–µ–Ω –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤–∏–¥–∞: https://api.telegram.org/bot<–ø–æ–ª–æ–∂–∏—Ç–µ_—Å—é–¥–∞_—Å–≤–æ–π_—Ç–æ–∫–µ–Ω>/getUpdates
  - –≤ —Ç–µ–∫—Å—Ç–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¢–µ–ª–µ–≥—Ä–∞–º –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Ä—è–¥–æ–º —Å –Ω–∏–º –±—É–¥–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `id`, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–æ–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `chatId`.

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

* –ú–µ—Ç–æ–¥ `ConfigDecorator()` ‚Äî —ç—Ç–æ –æ–±—ë—Ä—Ç–∫–∞ (–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä) –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Å–µ–∫—Ä–µ—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º –∑–∞–ø—É—Å–∫–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –¥–ª—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏–ª–∏ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.
    - –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `ConfigDecorator()`:
      - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏,
      - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ CPU,
      - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—á–µ–µ –ª–∏ —Å–µ–π—á–∞—Å –≤—Ä–µ–º—è (—Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º crontab),
      - –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –∏–ª–∏ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä.

* –ú–µ—Ç–æ–¥ `TradeManager()` ‚Äî —ç—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –∑–∞–ø—É—Å–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∫–æ–Ω–≤–µ–π–µ—Ä–∞–º–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—å—Å—è –∞–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Ç–∏–∫–µ—Ä–æ–≤.
    - –ú–µ–Ω–µ–¥–∂–µ—Ä `TradeManager()`:
      - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–ø–æ—Ä—Ç–µ—Ä (—ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ `TinkoffBrokerServer()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤),
      - –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–µ—à –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –∏ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º –∫–æ–Ω–≤–µ–π–µ—Ä–µ –ª–∏—à–Ω–∏–π —Ä–∞–∑,
      - –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–æ –≤—Å–µ–º —Ç–∏–∫–µ—Ä–∞–º, —Ä–∞–∑–±–∏–≤–∞–µ—Ç –∏—Ö –Ω–∞ –Ω–∞–±–æ—Ä—ã,
      - –∫–∞–∂–¥—ã–π –Ω–∞–±–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–≤–æ–π –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏.

* –ö–ª–∞—Å—Å `TradeScenario()` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞: `Run()` –∏ `Steps()`.
    - `Run()` ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –ø–æ –≤—Å–µ–º —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–∏–∫–µ—Ä–∞–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
    - `Steps()` ‚Äî —ç—Ç–æ —Ä–∞–∑–¥–µ–ª —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∑–∞–ø—É—Å–∫–æ–º –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è –æ–¥–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞.


üöÄ –£—Å–ø–µ—Ö–æ–≤ –≤–∞–º –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–∏—Ä–∂–µ–≤–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏! –ò –ø—Ä–æ—Ñ–∏—Ç–∞!

[![gift](https://badgen.net/badge/gift/donate/green)](https://yoomoney.ru/fundraise/4WOyAgNgb7M.230111)
